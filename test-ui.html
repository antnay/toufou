<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Test - Toufou</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            font-family: sans-serif;
        }
    </style>
</head>
<body>
    <h1 id="title">Hello</h1>
    <button id="btn">Click me</button>

    <script>
        // Overlay Module (scoreboard overlay)
        
        const Phase = {
            LOSERS: 0,
            MID_BOSS: 1,
            BOSS: 2
        };

        let scoreElement = null;
        let hiScoreElement = null;
        let bombElement = null;
        let deathsElement = null;
        let phaseElement = null;
        let spellcardElement = null;
        let spellcardNameElement = null;

        let hiScore = 0;

        const PHASE_NAMES = {
            [Phase.LOSERS]: 'Phase: Losers',
            [Phase.MID_BOSS]: 'Phase: Mid Boss',
            [Phase.BOSS]: 'Phase: Boss'
        };

        const STAT_PANEL_WIDTH = 280;
        const SCORE_DIGITS = 9;

        function loadHighScore() {
            const savedHiScore = localStorage.getItem('toufou_hiscore');
            if (savedHiScore) {
                hiScore = parseInt(savedHiScore, 10);
            }
        }

        function formatScore(score) {
            return score.toString().padStart(SCORE_DIGITS, '0');
        }

        function createStatPanel() {
            const statPanel = document.createElement('div');
            statPanel.id = 'stat-panel';
            statPanel.style.cssText = `
                position: fixed;
                top: 0;
                right: 0;
                width: ${STAT_PANEL_WIDTH}px;
                height: 100%;
                background: linear-gradient(180deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
                border-left: 2px solid #4a4a6a;
                font-family: 'Courier New', monospace;
                color: #fff;
                z-index: 1000;
                padding: 20px;
                box-sizing: border-box;
                overflow-y: auto;
                pointer-events: none;
            `;
            return statPanel;
        }

        function createGameTitle() {
            const gameTitle = document.createElement('div');
            gameTitle.textContent = 'TOUFOU Prototpye ver0.1';
            gameTitle.style.cssText = `
                font-size: 24px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 30px;
                color: #a0a0ff;
                text-shadow: 0 0 10px rgba(160, 160, 255, 0.5);
            `;
            return gameTitle;
        }

        function createScoreSection() {
            const scoreSection = document.createElement('div');
            scoreSection.style.cssText = `
                margin-bottom: 25px;
                line-height: 1.6;
            `;

            const hiScoreDiv = document.createElement('div');
            hiScoreDiv.style.cssText = `
                font-size: 14px;
                color: #aaa;
                margin-bottom: 5px;
            `;

            const scoreDiv = document.createElement('div');
            scoreDiv.style.cssText = `
                font-size: 16px;
                font-weight: bold;
                color: #fff;
                margin-bottom: 15px;
            `;

            scoreSection.appendChild(hiScoreDiv);
            scoreSection.appendChild(scoreDiv);

            return {
                container: scoreSection,
                hiScore: hiScoreDiv,
                score: scoreDiv,
            };
        }

        function createStatsSection() {
            const statsSection = document.createElement('div');
            statsSection.style.cssText = `
                margin-bottom: 25px;
                line-height: 1.8;
                font-size: 14px;
            `;

            const bombDiv = document.createElement('div');
            bombDiv.style.cssText = 'color: #ffaa00;';

            const deathsDiv = document.createElement('div');
            deathsDiv.style.cssText = 'color: #ff6b6b;';

            statsSection.appendChild(bombDiv);
            statsSection.appendChild(deathsDiv);

            return {
                container: statsSection,
                bomb: bombDiv,
                deaths: deathsDiv,
            };
        }

        function createPhaseSection() {
            const phaseSection = document.createElement('div');
            phaseSection.style.cssText = `
                margin-bottom: 25px;
                font-size: 14px;
            `;
            return phaseSection;
        }

        function createSpellcardSection() {
            const spellcardSection = document.createElement('div');
            spellcardSection.style.cssText = `
                margin-bottom: 20px;
                padding: 15px;
                background: rgba(255, 100, 100, 0.1);
                border: 1px solid rgba(255, 100, 100, 0.3);
                border-radius: 5px;
                display: none;
            `;

            const spellcardLabel = document.createElement('div');
            spellcardLabel.textContent = 'Spell Card';
            spellcardLabel.style.cssText = `
                font-size: 12px;
                color: #ff6b6b;
                margin-bottom: 5px;
            `;
            spellcardSection.appendChild(spellcardLabel);

            const spellcardNameDiv = document.createElement('div');
            spellcardNameDiv.style.cssText = `
                font-size: 16px;
                font-weight: bold;
                color: #ffaaaa;
                text-shadow: 0 0 5px rgba(255, 170, 170, 0.5);
            `;
            spellcardSection.appendChild(spellcardNameDiv);

            return {
                container: spellcardSection,
                name: spellcardNameDiv,
            };
        }

        function createFooter() {
            const footer = document.createElement('div');
            footer.textContent = 'Bullet Hell';
            footer.style.cssText = `
                position: absolute;
                bottom: 20px;
                right: 20px;
                font-size: 11px;
                color: #666;
            `;
            return footer;
        }

        function initOverlay() {
            loadHighScore();

            const statPanel = createStatPanel();
            statPanel.appendChild(createGameTitle());

            const scoreSection = createScoreSection();
            hiScoreElement = scoreSection.hiScore;
            scoreElement = scoreSection.score;
            statPanel.appendChild(scoreSection.container);

            const statsSection = createStatsSection();
            bombElement = statsSection.bomb;
            deathsElement = statsSection.deaths;
            statPanel.appendChild(statsSection.container);

            phaseElement = createPhaseSection();
            statPanel.appendChild(phaseElement);

            const spellcardSection = createSpellcardSection();
            spellcardElement = spellcardSection.container;
            spellcardNameElement = spellcardSection.name;
            statPanel.appendChild(spellcardSection.container);

            statPanel.appendChild(createFooter());

            document.body.appendChild(statPanel);
        }

        function updateOverlay(state) {
            if (!scoreElement || !hiScoreElement || !bombElement || !deathsElement || 
                !phaseElement || !spellcardElement || !spellcardNameElement) {
                return;
            }

            if (state.score > hiScore) {
                hiScore = state.score;
                localStorage.setItem('toufou_hiscore', hiScore.toString());
            }

            hiScoreElement.textContent = `HiScore ${formatScore(hiScore)}`;
            scoreElement.textContent = `Score ${formatScore(state.score)}`;
            bombElement.textContent = `Bomb ${state.current_bomb}`;
            deathsElement.textContent = `Deaths ${state.deaths}`;
            phaseElement.textContent = PHASE_NAMES[state.current_phase] || 'Phase: Unknown';

            if (state.boss.spellcard_on && state.boss.spellcard) {
                spellcardNameElement.textContent = `"${state.boss.spellcard}"`;
                spellcardElement.style.display = 'block';
            } else {
                spellcardElement.style.display = 'none';
            }
        }

        // UI Module (user input handling)
        function initUI() {
            const title = document.getElementById('title');
            const btn = document.getElementById('btn');
            
            if (title) {
                title.style.display = 'none';
            }
            if (btn) {
                btn.style.display = 'none';
            }
        }

        function handleKeyboardInput(event) {
            // TODO: Implement arrow keys for movement, spacebar for bomb, Z key for shooting
        }

        function handleMouseInput(event) {
            // TODO: Implement mouse-based player movement
        }

        window.addEventListener('DOMContentLoaded', () => {
            initUI();
            initOverlay();
            
            // Display sample data for testing
            setTimeout(() => {
                const sampleState = {
                    stage: {},
                    current_phase: Phase.BOSS,
                    player: {},
                    losers: [],
                    mid_boss: {},
                    boss: {
                        spellcard_on: true,
                        spellcard: "Master Spark"
                    },
                    current_bomb: 3,
                    score: 1234567,
                    deaths: 2
                };
                
                updateOverlay(sampleState);
            }, 100);
        });
    </script>
</body>
</html>